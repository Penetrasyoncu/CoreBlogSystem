@using X.PagedList
@using X.PagedList.Mvc.Core
@using CoreBlogSystem.Helpers
@model IPagedList<EntityLayer.Concrete.Category>
@{
    ViewData["Title"] = "Kategoriler";
    Layout = "~/Views/Shared/AdminLayout.cshtml";
}

<div class="row">
    <div class="col-lg-12">
        <div class="ibox ">
            <div class="ibox-title">
                <h5>Tüm Kategoriler</h5>
                <div class="ibox-tools">
                    <a class="collapse-link">
                        <i class="fa fa-chevron-up"></i>
                    </a>
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <i class="fa fa-wrench"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-user">
                        <li>
                            <a href="#" class="dropdown-item">Config option 1</a>
                        </li>
                        <li>
                            <a href="#" class="dropdown-item">Config option 2</a>
                        </li>
                    </ul>
                    <a class="close-link">
                        <i class="fa fa-times"></i>
                    </a>
                </div>
            </div>
            <div class="ibox-content">

                <table class="table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Kategori Adı</th>
                            <th>Durumu</th>
                            <th>İşlemler</th>
                            <th>Sil</th>
                            <th>Düzenle</th>
                        </tr>
                    </thead>
                    <tbody>

                        @foreach (var item in Model)
                        {
                            if (item.CategoryStatus != Enums.Status.Silinmis)
                            {
                                <tr>
                                    <th>@item.CategoryID</th>
                                    <td>@item.CategoryName</td>
                                    <td><span class="badge badge-primary">@item.CategoryStatus</span></td>
                                    @if (item.CategoryStatus == Enums.Status.Pasif)
                                    {
                                        <td><a href="/Admin/Category/ActiveCategoryAdmin/@item.CategoryID" class="btn btn-info">Aktif Yap</a></td>
                                    }
                                    else if (item.CategoryStatus == Enums.Status.Aktif)
                                    {
                                        <td><a href="/Admin/Category/PassiveCategoryAdmin/@item.CategoryID" class="btn btn-warning">Pasif Yap</a></td>
                                    }
                                    @*<td><a href="/Admin/Category/DeleteCategoryAdmin/@item.CategoryID" onclick="return confirm('Bağlı Kategoriler Olabilir, Silmek İstediğinizden Emin Misiniz?')" class="btn btn-danger">Sil</a></td>*@
                                    <td><a href="javascript:void(0);" onclick="Delete(@item.CategoryID , '@item.CategoryName')" class="btn btn-danger">Sil</a></td>
                                    <td><a href="/Admin/Category/EditCategoryAdmin/@item.CategoryID" class="btn btn-success">Düzenle</a></td>
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-2">
        <a href="/Admin/Category/AddCategoryAdmin" class="btn btn-primary">Yeni Kategori Ekle</a>
    </div>
    <div class="col-md-2">
        <a href="/Admin/Category/Export" class="btn btn-primary">Kategori Excel Listesini İndir</a>
    </div>
</div>
<br />

@Html.PagedListPager((IPagedList) Model, page => Url.Action("Index", new { page }))

@section Scripts{
<script>
    function Delete(id, name) {
        Swal.fire({
            title: name,
            text: "Bu Kategoriye Bağlı Yazılar Var Emin Misiniz?",
            type: 'question',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Evet, Sil.',
            cancelButtonText: 'Hayır, Kontrol Edeceğim.'
        }).then((result) => {
            if (result.value) {
                $.post("/Admin/Category/DeleteCategoryAdmin", { categoryID: id }, function (result) {
                    if (result) {
                        toastr['success'](name + ' başarıyla silindi.', 'Başarılı');
                        document.getElementById(id).remove();
                    }
                    else {
                        toastr['error']('Silme işleminde hata oluştu.', 'Hatalı');
                    }
                });
            }
        })
    }
</script>
}
